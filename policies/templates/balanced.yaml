# CloakPivot Balanced Policy Template
# Provides reasonable security with good usability balance
# Suitable for most production environments

version: "1.0"
name: "balanced-template"
description: "Balanced security and usability for production environments"

# Core configuration
locale: "en"
seed: "balanced-template-v1-2023"
min_entity_length: 2

# Default strategy for entities without specific configuration
default_strategy:
  kind: "partial"
  parameters:
    visible_chars: 3
    position: "start"
    preserve_delimiters: true

# Entity-specific strategies optimized for balance
per_entity:
  # Person names - template replacement for consistency
  PERSON:
    kind: "template"
    parameters:
      template: "[PERSON]"
    threshold: 0.7
    enabled: true

  # Email addresses - partial masking preserving domain
  EMAIL_ADDRESS:
    kind: "partial"
    parameters:
      visible_chars: 3
      position: "start"
      format_aware: true
      preserve_delimiters: true
    threshold: 0.6
    enabled: true

  # Phone numbers - show last 4 digits
  PHONE_NUMBER:
    kind: "partial"
    parameters:
      visible_chars: 4
      position: "end"
      format_aware: true
      preserve_delimiters: true
    threshold: 0.7
    enabled: true

  # SSN - standard template
  US_SSN:
    kind: "template"
    parameters:
      template: "XXX-XX-XXXX"
      preserve_format: true
    threshold: 0.9
    enabled: true

  # Credit cards - show last 4 digits (PCI compliance)
  CREDIT_CARD:
    kind: "partial"
    parameters:
      visible_chars: 4
      position: "end"
      format_aware: true
      preserve_delimiters: true
    threshold: 0.8
    enabled: true

  # IP addresses - partial for network diagnostics
  IP_ADDRESS:
    kind: "partial"
    parameters:
      visible_chars: 7  # Show first two octets
      position: "start"
      format_aware: true
    threshold: 0.6
    enabled: true

  # URLs - preserve domain structure
  URL:
    kind: "partial"
    parameters:
      visible_chars: 10
      position: "start"
      format_aware: true
    threshold: 0.6
    enabled: true

  # Bank account numbers - secure template
  US_BANK_NUMBER:
    kind: "partial"
    parameters:
      visible_chars: 4
      position: "end"
    threshold: 0.9
    enabled: true

  # Dates - preserve year for context
  DATE_TIME:
    kind: "partial"
    parameters:
      visible_chars: 4
      position: "start"
      format_aware: true
    threshold: 0.5
    enabled: true

# Global confidence thresholds
thresholds:
  PERSON: 0.7
  EMAIL_ADDRESS: 0.6
  PHONE_NUMBER: 0.7
  US_SSN: 0.9
  CREDIT_CARD: 0.8
  IP_ADDRESS: 0.6
  URL: 0.6
  US_BANK_NUMBER: 0.9
  DATE_TIME: 0.5
  LOCATION: 0.6
  ORGANIZATION: 0.6

# Context-specific masking rules
context_rules:
  # Don't mask PII in document headings
  heading:
    enabled: false
    reason: "Preserve document structure and readability"

  # Enable masking in tables with higher confidence
  table:
    enabled: true
    threshold_overrides:
      PERSON: 0.8
      EMAIL_ADDRESS: 0.7
      PHONE_NUMBER: 0.8
    reason: "Tables often contain structured PII data"

  # Preserve contact information in footers
  footer:
    enabled: false
    exceptions:
      - US_SSN    # Always mask SSN regardless of context
      - CREDIT_CARD
    reason: "Footers typically contain legitimate contact info"

  # Standard masking in body text
  body:
    enabled: true
    reason: "Body text is the primary content area"

  # Limited masking in headers
  header:
    enabled: false
    exceptions:
      - US_SSN
      - CREDIT_CARD
    reason: "Headers usually contain metadata, not personal data"

# Allow list - items that should never be masked
allow_list:
  - "Customer Service"
  - "Customer Support"
  - "Technical Support"
  - "Help Desk"
  - "Information Desk"
  - "General Information"
  - "Public Information"
  - "Emergency Contact"
  - "Emergency Services"
  - "System Administrator"
  - "support@company.com"
  - "info@company.com"
  - "admin@company.com"

# Deny list - items that should always be masked
deny_list:
  - "confidential"
  - "proprietary"
  - "internal use only"
  - "restricted"
  - "classified"
  - "sensitive"
  - "private"
  - "do not distribute"
  - "not for distribution"

# Performance and behavior settings
performance:
  # Enable conflict resolution for overlapping entities
  resolve_conflicts: true
  
  # Parallel processing settings
  max_workers: 4
  
  # Memory optimization
  chunk_size: 1000
  
  # Cache settings for repeated processing
  enable_caching: true

# Security settings
security:
  # Require integrity verification
  verify_integrity: true
  
  # Enable audit logging
  audit_logging: true
  
  # Deterministic processing
  deterministic: true

# Locale-specific settings
locales:
  "en":
    recognizers: 
      - "PERSON"
      - "EMAIL_ADDRESS" 
      - "PHONE_NUMBER"
      - "US_SSN"
      - "CREDIT_CARD"
    date_formats:
      - "%Y-%m-%d"
      - "%m/%d/%Y"
      - "%d/%m/%Y"

  "es":
    recognizers:
      - "PERSON"
      - "EMAIL_ADDRESS"
      - "ES_DNI"
      - "SPANISH_PHONE"
    date_formats:
      - "%d/%m/%Y"

# Compliance notes
compliance:
  frameworks:
    - "GDPR Article 32 - Security of processing"
    - "CCPA - Reasonable security measures"
    - "SOC2 Type II - Data protection"
  
  notes: |
    This balanced policy provides:
    - Reasonable privacy protection for most PII types
    - Preservation of document structure and readability
    - Performance optimized for production use
    - Compliance with common data protection frameworks
    
    Review and customize thresholds based on your specific requirements.

# Version history
changelog:
  - version: "1.0"
    date: "2023-12-07"
    changes: "Initial balanced template with standard strategies"